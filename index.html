<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="tab-title">Algebra Quiz II</title>
    <link id="tab-icon" rel="icon" type="image/x-icon" href="https://ssl.gstatic.com/docs/documents/images/kix-favicon7.ico">
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Inter:wght@100;400;900&display=swap");
        :root { 
            --bg: #000; 
            --text: #fff; 
            --border: rgba(255,255,255,0.15); 
            --glass: rgba(10,10,10,0.95); 
        }
        * { box-sizing: border-box; }
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; overflow: hidden; }
        
        /* Navigation & Tabs */
        #nav-container { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; background: var(--glass); backdrop-filter: blur(15px); border-bottom: 1px solid var(--border); }
        .nav-controls { height: 50px; display: flex; align-items: center; padding: 0 15px; gap: 10px; }
        #nav-url { flex-grow: 1; background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: #fff; padding: 8px 15px; border-radius: 5px; outline: none; font-size: 0.8rem; }
        
        .tab-bar { height: 35px; display: flex; background: rgba(0,0,0,0.3); padding: 0 10px; gap: 5px; align-items: center; border-top: 1px solid rgba(255,255,255,0.05); overflow-x: auto; }
        .tab { padding: 4px 12px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); font-size: 0.7rem; border-radius: 4px; cursor: pointer; color: #888; display: flex; align-items: center; gap: 8px; white-space: nowrap; }
        .tab.active { background: rgba(255,255,255,0.15); color: #fff; border-color: #fff; }
        .tab-close { opacity: 0.5; font-weight: bold; }
        .tab-close:hover { color: #ff4d4d; }

        .nav-btn { background: transparent; border: none; color: white; cursor: pointer; padding: 5px; display: flex; align-items: center; }
        .nav-btn svg { width: 18px; height: 18px; fill: none; stroke: currentColor; stroke-width: 2; }

        /* Proxy Viewport */
        .proxy-frame { position: fixed; top: 85px; left: 0; width: 100vw; height: calc(100vh - 85px); border: none; background: #000; display: none; z-index: 100; }
        .proxy-frame.active { display: block !important; }

        /* Main UI */
        .centered-wrapper { position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; z-index: 10; padding: 20px; text-align: center; }
        .logo-wrapper h1 { font-size: 4rem; font-weight: 900; letter-spacing: -2px; text-transform: uppercase; margin: 0; }
        .logo-wrapper h1 span { font-weight: 100; color: #666; margin-left: 10px; letter-spacing: 5px; }
        #sj-form { width: 100%; max-width: 500px; margin-top: 30px; }
        #sj-address { width: 100%; height: 55px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); color: white; padding: 0 20px; text-align: center; outline: none; border-radius: 8px; font-size: 1rem; }
        
        #constellation-canvas { position: fixed; inset: 0; z-index: 1; opacity: 0.6; pointer-events: none; }
    </style>
</head>
<body>
    <canvas id="constellation-canvas"></canvas>

    <div id="nav-container">
        <div class="nav-controls">
            <button class="nav-btn" onclick="controlFrame('back')"><svg viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg></button>
            <input type="text" id="nav-url" placeholder="Search or type URL..." autocomplete="off">
            <button class="nav-btn" onclick="addTab()"><svg viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg></button>
            <button class="nav-btn" onclick="location.reload()"><svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/></svg></button>
        </div>
        <div class="tab-bar" id="tab-bar"></div>
    </div>

    <main class="centered-wrapper" id="main-ui">
        <div class="logo-wrapper"><h1>NikeNetwork<span>V2</span></h1></div>
        <form id="sj-form">
            <input id="sj-address" type="text" placeholder="Access learning modules..." autofocus autocomplete="off" />
        </form>
    </main>

    <script>
        let tabs = [];
        let activeTabId = null;

        const mainUI = document.getElementById("main-ui");
        const navUrl = document.getElementById("nav-url");
        const sjAddress = document.getElementById("sj-address");

        document.getElementById("sj-form").onsubmit = (e) => {
            e.preventDefault();
            launchProxy(sjAddress.value);
        };

        navUrl.onkeydown = (e) => {
            if (e.key === "Enter") launchProxy(navUrl.value);
        };

        function launchProxy(input) {
            if (!input) return;
            let url = input.trim();
            if (!url.includes('.') || url.includes(' ')) {
                url = 'https://duckduckgo.com/?q=' + encodeURIComponent(url);
            } else if (!url.startsWith('http')) {
                url = 'https://' + url;
            }

            const id = 'task-' + Date.now();
            const encryptedUrl = btoa(url);
            
            const frame = document.createElement('iframe');
            frame.id = 'frame-' + id;
            frame.className = 'proxy-frame';
            frame.src = window.location.origin + '/assignments/' + encryptedUrl;
            
            document.body.appendChild(frame);
            tabs.push({ id, url, frame });
            switchTab(id);
            mainUI.style.display = "none";
            sjAddress.value = "";
        }

        function switchTab(id) {
            activeTabId = id;
            document.querySelectorAll('.proxy-frame').forEach(f => f.classList.remove('active'));
            const activeTab = tabs.find(t => t.id === id);
            if (activeTab) {
                document.getElementById('frame-' + id).classList.add('active');
                navUrl.value = activeTab.url;
            }
            renderTabs();
        }

        function renderTabs() {
            const bar = document.getElementById("tab-bar");
            bar.innerHTML = "";
            tabs.forEach(t => {
                const div = document.createElement("div");
                div.className = `tab ${t.id === activeTabId ? 'active' : ''}`;
                div.innerHTML = `<span>Module ${t.id.split('-')[1].slice(-4)}</span> <span class="tab-close" onclick="closeTab(event, '${t.id}')">Ã—</span>`;
                div.onclick = () => switchTab(t.id);
                bar.appendChild(div);
            });
        }

        window.closeTab = (e, id) => {
            e.stopPropagation();
            tabs = tabs.filter(t => t.id !== id);
            const frame = document.getElementById('frame-' + id);
            if (frame) frame.remove();
            
            if (tabs.length === 0) {
                mainUI.style.display = "flex";
                activeTabId = null;
                navUrl.value = "";
            } else if (activeTabId === id) {
                switchTab(tabs[tabs.length - 1].id);
            }
            renderTabs();
        };

        window.controlFrame = (action) => {
            const current = document.getElementById('frame-' + activeTabId);
            if (current && action === 'back') current.contentWindow.history.back();
        };

        window.addTab = () => {
            mainUI.style.display = "flex";
            sjAddress.focus();
        };

        // Constellation Animation
        const canvas = document.getElementById('constellation-canvas');
        const ctx = canvas.getContext('2d');
        let points = [];
        function init() {
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            points = Array.from({length: 60}, () => ({
                x: Math.random() * canvas.width, y: Math.random() * canvas.height,
                vx: (Math.random() - 0.5) * 0.7, vy: (Math.random() - 0.5) * 0.7, radius: Math.random() * 1.5 + 0.5
            }));
        }
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            points.forEach((p, i) => {
                p.x += p.vx; p.y += p.vy;
                if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
                ctx.beginPath(); ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                ctx.fillStyle = "rgba(255, 255, 255, 0.8)"; ctx.fill();
                for (let j = i + 1; j < points.length; j++) {
                    const p2 = points[j];
                    const dist = Math.sqrt((p.x - p2.x)**2 + (p.y - p2.y)**2);
                    if (dist < 150) {
                        ctx.beginPath(); ctx.moveTo(p.x, p.y); ctx.lineTo(p2.x, p2.y);
                        ctx.strokeStyle = `rgba(255, 255, 255, ${1 - dist / 150 - 0.2})`;
                        ctx.lineWidth = 0.5; ctx.stroke();
                    }
                }
            });
            requestAnimationFrame(animate);
        }
        window.onresize = init; init(); animate();
    </script>
</body>
</html>
